<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Images to Pinata IPFS</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 20px; margin: 20px 0; text-align: center; }
        .upload-area.dragover { border-color: #007bff; background-color: #f8f9fa; }
        .image-preview { max-width: 200px; max-height: 200px; margin: 10px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Upload Images to Pinata IPFS</h1>
    
    <div class="upload-area" id="uploadArea">
        <p>Drop images here or click to select</p>
        <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
        <button onclick="document.getElementById('fileInput').click()">Select Images</button>
    </div>
    
    <div id="previews"></div>
    <button onclick="uploadAllImages()" id="uploadBtn" style="display: none;">Upload All to Pinata</button>
    <div id="results"></div>

    <script>
        const PINATA_API_KEY = '8ba2dcf332749804d589';
        const PINATA_SECRET_KEY = '3d413242a71d1c07cd1a67c6b0956738ccea600c80398e83a4a68b1c20b72ac5';
        
        let selectedFiles = [];

        // Drag and drop functionality
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewsDiv = document.getElementById('previews');
        const uploadBtn = document.getElementById('uploadBtn');
        const resultsDiv = document.getElementById('results');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            handleFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFiles(files);
        });

        function handleFiles(files) {
            selectedFiles = files;
            previewsDiv.innerHTML = '';
            
            if (files.length === 0) {
                uploadBtn.style.display = 'none';
                return;
            }

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.createElement('div');
                    preview.style.display = 'inline-block';
                    preview.style.margin = '10px';
                    preview.innerHTML = `
                        <img src="${e.target.result}" class="image-preview" alt="${file.name}">
                        <p>${file.name}</p>
                    `;
                    previewsDiv.appendChild(preview);
                };
                reader.readAsDataURL(file);
            });

            uploadBtn.style.display = 'block';
        }

        async function uploadAllImages() {
            if (selectedFiles.length === 0) {
                resultsDiv.innerHTML = '<div class="error">No files selected</div>';
                return;
            }

            resultsDiv.innerHTML = '<div class="info">Uploading images to Pinata...</div>';
            const uploadResults = [];

            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                try {
                    resultsDiv.innerHTML = `<div class="info">Uploading ${file.name} (${i + 1}/${selectedFiles.length})...</div>`;
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    const metadata = JSON.stringify({
                        name: `NFT Image - ${file.name}`,
                        keyvalues: {
                            type: 'nft_image',
                            filename: file.name,
                            uploaded_at: new Date().toISOString()
                        }
                    });
                    formData.append('pinataMetadata', metadata);

                    const response = await fetch('https://api.pinata.cloud/pinning/pinFileToIPFS', {
                        method: 'POST',
                        headers: {
                            'pinata_api_key': PINATA_API_KEY,
                            'pinata_secret_api_key': PINATA_SECRET_KEY
                        },
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Upload failed: ${response.status}`);
                    }

                    const result = await response.json();
                    uploadResults.push({
                        filename: file.name,
                        ipfsHash: result.IpfsHash,
                        ipfsUrl: `https://gateway.pinata.cloud/ipfs/${result.IpfsHash}`,
                        success: true
                    });

                } catch (error) {
                    console.error(`Error uploading ${file.name}:`, error);
                    uploadResults.push({
                        filename: file.name,
                        error: error.message,
                        success: false
                    });
                }
            }

            // Display results
            const successCount = uploadResults.filter(r => r.success).length;
            const errorCount = uploadResults.filter(r => !r.success).length;

            let resultsHTML = `
                <div class="success">
                    âœ… Upload completed: ${successCount} successful, ${errorCount} failed
                </div>
                <h3>Upload Results:</h3>
            `;

            uploadResults.forEach(result => {
                if (result.success) {
                    resultsHTML += `
                        <div class="result success">
                            <strong>${result.filename}</strong><br>
                            <strong>IPFS Hash:</strong> ${result.ipfsHash}<br>
                            <strong>IPFS URL:</strong> <a href="${result.ipfsUrl}" target="_blank">${result.ipfsUrl}</a><br>
                            <button onclick="copyToClipboard('${result.ipfsHash}')">Copy Hash</button>
                            <button onclick="copyToClipboard('${result.ipfsUrl}')">Copy URL</button>
                        </div>
                    `;
                } else {
                    resultsHTML += `
                        <div class="result error">
                            <strong>${result.filename}</strong><br>
                            <strong>Error:</strong> ${result.error}
                        </div>
                    `;
                }
            });

            // Add code snippet for enhanced-nft-distribution.html
            if (successCount > 0) {
                const imageOptions = uploadResults
                    .filter(r => r.success)
                    .map(r => `'${r.ipfsUrl}'`)
                    .join(', ');

                resultsHTML += `
                    <h3>Code for enhanced-nft-distribution.html:</h3>
                    <div class="result info">
                        <p>Replace the image selection in your distribution tool with:</p>
                        <pre>const availableImages = [${imageOptions}];
const randomImage = availableImages[Math.floor(Math.random() * availableImages.length)];</pre>
                        <button onclick="copyToClipboard('const availableImages = [${imageOptions}];\\nconst randomImage = availableImages[Math.floor(Math.random() * availableImages.length)];')">Copy Code</button>
                    </div>
                `;
            }

            resultsDiv.innerHTML = resultsHTML;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }
    </script>
</body>
</html>
